<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {
            outline: 2px solid black !important;
        }
    </style>
</head>

<body>
    <a id="title"></a>
    <script src="../third_party/g2.full.js"></script>
    <script src="../third_party/mec2.min.js"></script>
    <script src="../third_party/opencv.js"></script>
    <script src="../scripts/simulation.js"></script>
    <script src="../scripts/group.js"></script>
    <script src="../scripts/data.js"></script>
    <script src="../scripts/pointCloud.js"></script>
    <script src="../scripts/line.js"></script>
    <script src="momentanpol1.js"></script>

    <p>
        Test zur Bestimmung des Momentanpols in einem Rad, wobei der sichtbare Teil sich auf eine "Speiche" reduzieren soll um die Drehung zu zeigen.
        Hier wird die Geschwindigkeit durch den Abstand der meisten distanzierten Punkte in verschiedenen Interationen gemessen.
        Die Winkelgeschwindigkeit wird Ã¼ber die Regressionsgerade bestimmt.
    </p>

    <script>
        const { group, data } = globalMomentanpol1Variables;
        const fn = (result) => {
            roll();

            const g = g2().clr();
            const { p1, p2 } = result.getMaxDist(g);

            group.addPoints([p1, p2]);
            group.lines.push(Line.fromRegressionLine(result, g));
            result.draw(g);

            const threshold = 20;
            if (group.pts[0].length > threshold) {
                const l = group.getPoint(0);
                const b = group.getPoint(0, threshold);

                const va = {
                    x: l.x - b.x,
                    y: l.y - b.y,
                }

                const l1 = group.lines[group.lines.length - 1];
                const l2 = group.lines[group.lines.length - threshold];

                const dw = (Math.atan(l1.m) - Math.atan(l2.m) + Math.PI) % Math.PI;

                const rp = {
                    x: (l.x + b.x) / 2 - va.y / dw,
                    y: (l.y + b.y) / 2 + va.x / dw,
                };

                data.add(rp);
            }

            data.draw(g);
            data.getChart(false).exe(globalTestVariables.ctx3);
            g.exe(globalTestVariables.ctx2);
        };

        globalTestVariables.register(() => stepCompareImages(fn));
    </script>
</body>

</html>